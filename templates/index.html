<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Compliance Copilot ‚Äî Spec/Rev Guard</title>
  <link rel="stylesheet" href="/static/styles.css" />
  <script>
    async function handleUpload(ev) {
      ev.preventDefault();
      const form = document.getElementById('uploadForm');
      const data = new FormData(form);
      const res = await fetch('/upload', { method: 'POST', body: data });
      const json = await res.json();
      const note = document.querySelector('#uploadNote');
      note.textContent = 'Uploaded: ' + (json.saved || []).join(', ');
      note.classList.add('show');
      setTimeout(() => window.location.reload(), 900);
    }
  </script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">AC</div>
        <div class="brand-text">
          <div class="title">AI Compliance</div>
          <div class="subtitle">Copilot</div>
        </div>
      </div>
      <nav class="nav">
        <a class="nav-item active" href="/">
          <span class="icon">üè†</span> Dashboard
        </a>
        <a class="nav-item" href="/">
          <span class="icon">üìÑ</span> Documents
        </a>
        <a class="nav-item" href="/search?query=tolerance">
          <span class="icon">üîé</span> Search
        </a>
        <a class="nav-item" href="#">
          <span class="icon">‚öôÔ∏è</span> Settings
        </a>
      </nav>
      <div class="sidebar-footer">{{ files|length }} files available</div>
    </aside>

    <main class="content">
      <header class="topbar">
        <div class="topbar-left">
          <div class="page-title">Spec/Rev Guard</div>
          <div class="tag">Prototype</div>
        </div>
        <div class="searchbox">
          <form action="/search" method="get">
            <input type="text" name="query" placeholder="Search documents..." />
          </form>
        </div>
        <div class="user">
          <div class="avatar">A</div>
        </div>
      </header>

      <section class="panels">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Upload Documents</div>
            <div class="panel-sub">PDF, DOCX, TXT</div>
          </div>
          <form id="uploadForm" onsubmit="handleUpload(event)">
            <div class="upload">
              <input class="file" name="files" type="file" multiple accept=".pdf,.docx,.doc,.txt,.text" />
              <button class="btn btn-primary" type="submit">Upload</button>
            </div>
            <div id="uploadNote" class="note"></div>
            <div class="hint">Files are stored under <code>data/uploads</code> and ingested automatically.</div>
          </form>
        </div>

        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Compare Revisions & Tolerances</div>
            <div class="panel-sub">Select 2‚Äì3 related docs</div>
          </div>
          <form method="POST" action="/compare_ui">
            <div class="card-grid">
              {% for f in files %}
              <label class="card-item">
                <input type="checkbox" name="filenames" value="{{ f }}" {% if selected and f in selected %}checked{% endif %}/>
                <div class="card-body">
                  <div class="card-icon">üìÑ</div>
                  <div class="card-title">{{ f }}</div>
                  <div class="card-meta">Ready</div>
                </div>
              </label>
              {% else %}
              <div class="empty">No files found in <code>data/</code></div>
              {% endfor %}
            </div>
            <div class="actions">
              <button class="btn btn-primary" type="submit">Compare Selected</button>
              <span class="muted">Hold Ctrl/Cmd to pick multiple.</span>
            </div>
          </form>
        </div>

        {% if report %}
        <div class="panel full">
          <div class="panel-header">
            <div class="panel-title">Compare Report</div>
            <div class="panel-sub">{{ report.mismatches|length }} mismatches</div>
          </div>
          <div class="table-wrap">
            <table class="table">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Clause</th>
                  <th>Doc A</th>
                  <th>Doc B</th>
                </tr>
              </thead>
              <tbody>
              {% if report.mismatches|length == 0 %}
                <tr><td colspan="4" class="ok">No mismatches detected</td></tr>
              {% endif %}
              {% for m in report.mismatches %}
                <tr>
                  <td><span class="pill pill-{{ m.type }}">{{ m.type }}</span></td>
                  <td class="clause">{{ m.clause }}</td>
                  <td>
                    <div class="val"><strong>{{ m.a.filename }}</strong> ‚Äî {{ m.a.value }}</div>
                    <div class="cite">p. {{ m.a.page }}, line {{ m.a.line }}</div>
                    {% if m.a.context %}<div class="context">{{ m.a.context }}</div>{% endif %}
                  </td>
                  <td>
                    <div class="val"><strong>{{ m.b.filename }}</strong> ‚Äî {{ m.b.value }}</div>
                    <div class="cite">p. {{ m.b.page }}, line {{ m.b.line }}</div>
                    {% if m.b.context %}<div class="context">{{ m.b.context }}</div>{% endif %}
                  </td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        {% endif %}
      </section>
    </main>

    <aside class="rightbar">
      <div class="sidepanel">
        <div class="sidepanel-title">Quick Controls</div>
        <div class="switch">
          <label>
            <input type="checkbox" checked />
            <span class="slider"></span>
            Auto-ingest uploads
          </label>
        </div>
        <div class="switch">
          <label>
            <input type="checkbox" />
            <span class="slider"></span>
            Strict tolerance check
          </label>
        </div>
      </div>
      <div class="sidepanel">
        <div class="sidepanel-title">Summary</div>
        <div class="stats">
          <div class="stat">
            <div class="stat-val">{{ files|length }}</div>
            <div class="stat-label">Files</div>
          </div>
          <div class="stat">
            <div class="stat-val">{{ report.mismatches|length if report else 0 }}</div>
            <div class="stat-label">Mismatches</div>
          </div>
        </div>
      </div>
    </aside>
  </div>
</body>
</html>
